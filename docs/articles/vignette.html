<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flightscanner: Find the Best Flight For You! • flightscanner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Flightscanner: Find the Best Flight For You!">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flightscanner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette.html">Flightscanner: Find the Best Flight For You!</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MinZhang95/flightscanner">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Flightscanner: Find the Best Flight For You!</h1>
                        <h4 class="author">Dapeng Hu, Yang Qiao, Min Zhang, Xin Zhang and Zerui Zhang</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MinZhang95/flightscanner/blob/master/vignettes/vignette.Rmd"><code>vignettes/vignette.Rmd</code></a></small>
      <div class="hidden name"><code>vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Finding the cheapest flight from point A to point B could be a headache for many of us, especially with other multiple constraints, such as duration, layover, departure and arrival time, etc. The goal of the <code>flightscanner</code> package is to provide a simple and straightforward interface for interacting with <a href="https://rapidapi.com/skyscanner/api/skyscanner-flight-search">Rapid API – Skyscanner</a> through R. The Skyscanner API lets users to search for flight and query flight prices from Skyscanner’s database, as well as quotes from ticketing agencies. Besides these basic functionalities as a flight searching tool, <code>flightscanner</code> also allows users to schedule searches and record results antomatically. In addition, this package provides a Shiny APP to visualize the trip on a map and to show the available ticket options according to the customized constraints.</p>
</div>
<div id="getting-started-with-flightscanner" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started-with-flightscanner" class="anchor"></a>Getting Started with flightscanner</h2>
<p>At the time of this writing, <code>flightscanner</code> has not been submitted to CRAN. Right now, the <code>flightscanner</code> package can be easily installed through the <code>devtools</code> package with the function <code>install_github()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"MinZhang95/flightscanner"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(flightscanner)</code></pre></div>
<div id="setup-with-api-key" class="section level3">
<h3 class="hasAnchor">
<a href="#setup-with-api-key" class="anchor"></a>Setup with API key</h3>
<p>The first step in using the <code>flightscanner</code> package is to initialized the API connection to Skyscanner. If this is your first time of loading this package, you will be required to pass the API key received from Skyscanner into the console. Two questions will be prompted for users to quickly setup the API:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">API key is required<span class="op">!</span>
Please follow the instructions to get the key<span class="op">:</span>
<span class="dv">1</span>. Browse and login<span class="op">:</span><span class="st">  </span>https<span class="op">:</span><span class="er">//</span>rapidapi.com<span class="op">/</span>skyscanner<span class="op">/</span>api<span class="op">/</span>skyscanner<span class="op">-</span>flight<span class="op">-</span>search 
   Do you want to visit this <span class="kw">website</span> (<span class="dv">1</span> <span class="cf">for</span> YES; <span class="dv">0</span> <span class="cf">for</span> NO)?
   
<span class="dv">2</span>. Copy the value of X<span class="op">-</span>RapidAPI<span class="op">-</span>Key <span class="cf">in</span> Header Parameters.
   Paste your <span class="kw">key</span> (without quote)<span class="op">:</span></code></pre></div>
<p>By selecting “1” for the first question, the users will be directed to the Rapid API Skyscanner webpage, where the API key can be found in the right panel (Figure 1) and be used for the second question.</p>
<div class="figure" style="text-align: center">
<img src="APIwebpage.png" alt="Figure 1: Rapid API Skyscanner and API-key" width="100%"><p class="caption">
Figure 1: Rapid API Skyscanner and API-key
</p>
</div>
<p>A welcome message will show up with a valid API key:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Welcome to FlightScanner<span class="op">!</span></code></pre></div>
<p>The valid API key will be stored into “APIkey.txt” under the current working directory, so that the API key will not be required again and again everytime when the package is loaded.</p>
<p>However, with an invalid API key, a failure message will show up:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Check your key or network connection. And use <span class="cf">function</span> <span class="st">`</span><span class="dt">apiSetKey</span><span class="st">`</span> to set key later.</code></pre></div>
<p>Alternatively, the users could set (or reset) the API key manually with the function <code><a href="../reference/apiSetKey.html">apiSetKey()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/apiSetKey.html">apiSetKey</a></span>(<span class="st">"YOUR KEY"</span>)</code></pre></div>
<p>Please notice that <code><a href="../reference/apiSetKey.html">apiSetKey()</a></code> does not generate or rewrite “APIkey.txt” under the current working directory.</p>
<p>To obtain the global API key, use the function <code><a href="../reference/apiSetKey.html">apiGetKey()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/apiSetKey.html">apiGetKey</a></span>()</code></pre></div>
<p>This function will return the API key only if it has been successfully setup; otherwise it will return <code>NULL</code>.</p>
</div>
</div>
<div id="main-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#main-functions" class="anchor"></a>Main Functions</h2>
<div id="download-data-with-api" class="section level3">
<h3 class="hasAnchor">
<a href="#download-data-with-api" class="anchor"></a>Download data with API</h3>
<div id="apicreatesession" class="section level4">
<h4 class="hasAnchor">
<a href="#apicreatesession" class="anchor"></a><code><a href="../reference/apiCreateSession.html">apiCreateSession()</a></code>
</h4>
<p><code><a href="../reference/apiCreateSession.html">apiCreateSession()</a></code> allows the users to input their flight information (origin, destination and dates) and create a session on the API server. The output contains a session ID. For example, to buy a ticket from Des Moines to Detroit for an adult on 2019-06-01 (the departure date cannot be earlier than the current date):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_session &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/apiCreateSession.html">apiCreateSession</a></span>(<span class="dt">origin =</span> <span class="st">"DSM"</span>, <span class="dt">destination =</span> <span class="st">"DTW"</span>, <span class="dt">startDate =</span> <span class="st">"2019-06-01"</span>, <span class="dt">adults =</span> <span class="dv">1</span>)</code></pre></div>
<p>The output of <code><a href="../reference/apiCreateSession.html">apiCreateSession()</a></code> is used as the input of <code><a href="../reference/apiPollSession.html">apiPollSession()</a></code>.</p>
</div>
<div id="apipollsession" class="section level4">
<h4 class="hasAnchor">
<a href="#apipollsession" class="anchor"></a><code><a href="../reference/apiPollSession.html">apiPollSession()</a></code>
</h4>
<p><code><a href="../reference/apiPollSession.html">apiPollSession()</a></code> retrieves the flight data searched with <code><a href="../reference/apiCreateSession.html">apiCreateSession()</a></code> and allows the users to sort and filter the tickets by various standards. The default values of all filter variables are <code>NULL</code>, meaning that we do not filter anything before we obtain the actual data. For example, to search the previous result in price ascending order:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/apiPollSession.html">apiPollSession</a></span>(<span class="dt">response =</span> dsm2dtw_session, <span class="dt">sortType =</span> <span class="st">"price"</span>, <span class="dt">sortOrder =</span> <span class="st">"asc"</span>)</code></pre></div>
<p>Let’s check the content of the output of <code><a href="../reference/apiPollSession.html">apiPollSession()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_res <span class="op">%&gt;%</span><span class="st"> </span>content <span class="op">%&gt;%</span><span class="st"> </span>names
<span class="co">#&gt;  [1] "SessionKey"  "Query"       "Status"      "Itineraries" "Legs"       </span>
<span class="co">#&gt;  [6] "Segments"    "Carriers"    "Agents"      "Places"      "Currencies"</span></code></pre></div>
<p>The output of <code><a href="../reference/apiPollSession.html">apiPollSession()</a></code> is messy, because it contains several sub-lists, such as “itineraries”, “legs”, and “segments”. The relationship between these terms are shown below.</p>
<p><span class="math display">\[
\text{searching result} 
\begin{cases}
  \text{itinerary_1} 
    \begin{cases}
      \text{leg_1} 
        \begin{cases}
          \text{segment_1} \\
          \text{segment_2} \\
          \vdots \\
          \text{segment_S}
        \end{cases} \\
      \text{leg_2} 
        \begin{cases}
          \text{segment_1}
        \end{cases}
    \end{cases} \\
  \text{itinerary_2} 
    \begin{cases}
      \text{leg_1} 
        \begin{cases}
          \text{segment_1} \\
          \text{segment_2} 
        \end{cases} \\
      \text{leg_2} 
        \begin{cases}
          \text{segment_1}
        \end{cases}
    \end{cases} \\
  \vdots \\
  \text{itinerary_n} 
    \begin{cases}
      \text{leg_1} 
        \begin{cases}
          \text{segment_1} 
        \end{cases} \\
      \text{leg_2} 
        \begin{cases}
          \text{segment_1}
        \end{cases}
    \end{cases}
\end{cases}
\]</span></p>
<p>One searching request may contain several itineraries. A one-way trip contains one leg, whereas a round-way trip contains two: outbound leg and inbound leg. One leg contains several segments if it is not a direct flight.</p>
</div>
</div>
<div id="data-processing" class="section level3">
<h3 class="hasAnchor">
<a href="#data-processing" class="anchor"></a>Data Processing</h3>
<div id="flightget" class="section level4">
<h4 class="hasAnchor">
<a href="#flightget" class="anchor"></a><code><a href="../reference/flightGet.html">flightGet()</a></code>
</h4>
<p><code><a href="../reference/flightGet.html">flightGet()</a></code> allows users to input the result from <code>PollSession()</code> or to read from database (explain later in “Data Storage” section). The output contains a list of seven dataframes, whose names are printed below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_df &lt;-<span class="st"> </span>dsm2dtw_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/flightGet.html">flightGet</a></span>()
<span class="co">#&gt; Warning: Unmatch of Segments and Stops: [LegId] =</span>
<span class="co">#&gt; 11140-1906010743--30963,-32462-3-11152-1906020959</span>
<span class="co">#&gt; Warning: Unmatch of Segments and Stops: [LegId] =</span>
<span class="co">#&gt; 11140-1906011413--30963-1-11152-1906020959</span>
<span class="co">#&gt; Warning: Unmatch of Segments and Stops: [LegId] =</span>
<span class="co">#&gt; 11140-1906010713--30963-1-11152-1906011729</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(dsm2dtw_df)
<span class="co">#&gt; [1] "price"       "itineraries" "legs"        "segments"    "carriers"   </span>
<span class="co">#&gt; [6] "agents"      "places"</span></code></pre></div>
<p>The dataframe “price” provides information, such as the seraching time and pricing options:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_df<span class="op">$</span>price <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dt">width =</span> <span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   SearchTime          OutboundLegId                             </span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;chr&gt;                                     </span>
<span class="co">#&gt; 1 2019-05-09 19:55:01 11140-1906011835--31722-1-11152-1906012344</span>
<span class="co">#&gt; 2 2019-05-09 19:55:01 11140-1906010615--31722-1-11152-1906011349</span>
<span class="co">#&gt; 3 2019-05-09 19:55:01 11140-1906011520--31722-1-11152-1906012026</span>
<span class="co">#&gt;   InboundLegId PricingOptions  </span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;list&gt;          </span>
<span class="co">#&gt; 1 ""           &lt;tibble [1 × 3]&gt;</span>
<span class="co">#&gt; 2 ""           &lt;tibble [1 × 3]&gt;</span>
<span class="co">#&gt; 3 ""           &lt;tibble [1 × 3]&gt;</span></code></pre></div>
<p>Within the same itinerary, there might be several different prices due to different agents:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_df<span class="op">$</span>price<span class="op">$</span>PricingOptions[[<span class="dv">39</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dt">width =</span> <span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   AgentId Price</span>
<span class="co">#&gt;     &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1960211 4037.</span>
<span class="co">#&gt; 2 3987731 4052.</span>
<span class="co">#&gt;   LinkURL                                                                  </span>
<span class="co">#&gt;   &lt;chr&gt;                                                                    </span>
<span class="co">#&gt; 1 http://partners.api.skyscanner.net/apiservices/deeplink/v2?_cje=NqagL4PV…</span>
<span class="co">#&gt; 2 http://partners.api.skyscanner.net/apiservices/deeplink/v2?_cje=NqagL4PV…</span></code></pre></div>
<p>The dataframe “leg” provides information, such as duration and number of stops:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_df<span class="op">$</span>legs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dt">width =</span> <span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 3 x 9</span>
<span class="co">#&gt;   Id                  SegmentIds OriginId DestinationId DepartureTime      </span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;list&gt;        &lt;int&gt;         &lt;int&gt; &lt;dttm&gt;             </span>
<span class="co">#&gt; 1 11140-1906010605--… &lt;chr [3]&gt;     11140         11152 2019-06-01 06:05:00</span>
<span class="co">#&gt; 2 11140-1906011658--… &lt;chr [3]&gt;     11140         11152 2019-06-01 16:58:00</span>
<span class="co">#&gt; 3 11140-1906011705--… &lt;chr [2]&gt;     11140         11152 2019-06-01 17:05:00</span>
<span class="co">#&gt;   ArrivalTime         Duration No.Stops Stops               </span>
<span class="co">#&gt;   &lt;dttm&gt;                 &lt;int&gt;    &lt;int&gt; &lt;list&gt;              </span>
<span class="co">#&gt; 1 2019-06-01 18:14:00      669        2 &lt;data.frame [2 × 2]&gt;</span>
<span class="co">#&gt; 2 2019-06-02 14:20:00     1222        2 &lt;data.frame [2 × 2]&gt;</span>
<span class="co">#&gt; 3 2019-06-02 22:25:00     1700        1 &lt;data.frame [1 × 2]&gt;</span></code></pre></div>
<p>We can also check the stop information and the layover in minutes with the “leg” dataframe for each leg:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_df<span class="op">$</span>legs<span class="op">$</span>Stops <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dt">width =</span> <span class="dv">120</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;   StopId Layover</span>
<span class="co">#&gt; 1  12389      81</span>
<span class="co">#&gt; 2  15062     191</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;   StopId Layover</span>
<span class="co">#&gt; 1  15062      70</span>
<span class="co">#&gt; 2  16177     525</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;   StopId Layover</span>
<span class="co">#&gt; 1  10959    1416</span></code></pre></div>
<p>Similarly, the detailed results about the segments are stored in the “segments” dataframe:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_df<span class="op">$</span>segments <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dt">width =</span> <span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 2 x 9</span>
<span class="co">#&gt;   Id         OriginId DestinationId DepartureTime       ArrivalTime        </span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;int&gt;         &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;             </span>
<span class="co">#&gt; 1 11140-190…    11140         12389 2019-06-01 06:05:00 2019-06-01 08:41:00</span>
<span class="co">#&gt; 2 12389-190…    12389         15062 2019-06-01 10:02:00 2019-06-01 12:39:00</span>
<span class="co">#&gt;   Duration CarrierId OperatingCarrierId FlightNumber</span>
<span class="co">#&gt;      &lt;int&gt;     &lt;int&gt;              &lt;int&gt; &lt;chr&gt;       </span>
<span class="co">#&gt; 1      156      1793               -676 6115        </span>
<span class="co">#&gt; 2      157      1793               1793 1403</span></code></pre></div>
<p>In the above outputs, the carriers and stops are represented with their IDs. To “translate” to their names, run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsm2dtw_df<span class="op">$</span>carriers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dt">width =</span> <span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;      Id Code  Name                            </span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;                           </span>
<span class="co">#&gt; 1  -676 ""    Mesa Airlines DBA United Express</span>
<span class="co">#&gt;   ImageURL                                              </span>
<span class="co">#&gt;   &lt;chr&gt;                                                 </span>
<span class="co">#&gt; 1 https://s1.apideeplink.com/images/airlines/default.png</span>
dsm2dtw_df<span class="op">$</span>places <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dt">width =</span> <span class="dv">120</span>)
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;      Id ParentId Code  Type    Name      </span>
<span class="co">#&gt;   &lt;int&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     </span>
<span class="co">#&gt; 1 11140     2266 DSM   Airport Des Moines</span></code></pre></div>
</div>
<div id="flightfilter" class="section level4">
<h4 class="hasAnchor">
<a href="#flightfilter" class="anchor"></a><code><a href="../reference/flightFilter.html">flightFilter()</a></code>
</h4>
<p><code><a href="../reference/flightFilter.html">flightFilter()</a></code> allows users to filter the results obtained from <code><a href="../reference/flightGet.html">flightGet()</a></code>. Continued with the previous example, the user looks for flights with a budget of $1,000, no more than 1 stop, and departure time after 8AM:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/flightFilter.html">flightFilter</a></span>(dsm2dtw_df, <span class="dt">max_price =</span> <span class="dv">1000</span>, <span class="dt">max_stops =</span> <span class="dv">1</span>, <span class="dt">out_departure =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"08:00"</span>,<span class="st">"24:00"</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">3</span>)
<span class="co">#&gt; # A tibble: 3 x 15</span>
<span class="co">#&gt;   OutboundLegId InboundLegId PricingOptions OutboundLegSegm…</span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;        &lt;list&gt;         &lt;list&gt;          </span>
<span class="co">#&gt; 1 11140-190601… ""           &lt;tibble [1 × … &lt;data.frame [2 …</span>
<span class="co">#&gt; 2 11140-190601… ""           &lt;tibble [1 × … &lt;data.frame [2 …</span>
<span class="co">#&gt; 3 11140-190601… ""           &lt;tibble [1 × … &lt;data.frame [2 …</span>
<span class="co">#&gt; # … with 11 more variables: OutboundLegDepartureTime &lt;dttm&gt;,</span>
<span class="co">#&gt; #   OutboundLegArrivalTime &lt;dttm&gt;, OutboundLegDuration &lt;int&gt;,</span>
<span class="co">#&gt; #   OutboundLegNo.Stops &lt;int&gt;, OutboundLegStops &lt;list&gt;,</span>
<span class="co">#&gt; #   InboundLegSegments &lt;list&gt;, InboundLegDepartureTime &lt;dttm&gt;,</span>
<span class="co">#&gt; #   InboundLegArrivalTime &lt;dttm&gt;, InboundLegDuration &lt;int&gt;,</span>
<span class="co">#&gt; #   InboundLegNo.Stops &lt;int&gt;, InboundLegStops &lt;list&gt;</span></code></pre></div>
</div>
</div>
<div id="data-storage" class="section level3">
<h3 class="hasAnchor">
<a href="#data-storage" class="anchor"></a>Data Storage</h3>
<p>Storing flight data as database can be efficient for automatic searching.</p>
<div id="dbcreatedb" class="section level4">
<h4 class="hasAnchor">
<a href="#dbcreatedb" class="anchor"></a><code><a href="../reference/dbCreateDB.html">dbCreateDB()</a></code>
</h4>
<p><code><a href="../reference/dbCreateDB.html">dbCreateDB()</a></code> is a function to connect to the local database file, default is “flight.db”. This is the pre-configuration before saving data in database.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dbCreateDB.html">dbCreateDB</a></span>(<span class="dt">conn =</span> RSQLite<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/RSQLite/topics/SQLite">SQLite</a></span>(), <span class="dt">dbname =</span> <span class="st">"flight.db"</span>)</code></pre></div>
<p>The flight.db includes seven tables:</p>
<pre><code>#&gt; [1] "agent"     "carrier"   "itinerary" "leg"       "place"     "price"    
#&gt; [7] "segment"</code></pre>
<p>It will excute:</p>
<ol style="list-style-type: decimal">
<li>connect to SQLite driver.</li>
<li>create a local database file if it doesn’t exist.</li>
<li>create the schema of above seven tables if they don’t exist.</li>
</ol>
</div>
<div id="dbsavedata" class="section level4">
<h4 class="hasAnchor">
<a href="#dbsavedata" class="anchor"></a><code>dbSaveData</code>
</h4>
<p><strong><code>dbSaveDB</code></strong> is a function to save data into the databse file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/apiCreateSession.html">apiCreateSession</a></span>(<span class="dt">origin =</span> <span class="st">"DSM"</span>, <span class="dt">destination =</span> <span class="st">"DTW"</span>, <span class="dt">startDate =</span> <span class="st">"2019-06-01"</span>)
resp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/apiPollSession.html">apiPollSession</a></span>(resp)
data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flightGet.html">flightGet</a></span>(resp)

<span class="co"># Connect to SQLite database</span>
con &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dbCreateDB.html">dbCreateDB</a></span>(<span class="dt">dbname =</span> <span class="st">":memory:"</span>)
<span class="kw"><a href="../reference/dbSaveData.html">dbSaveData</a></span>(resp, con)  <span class="co"># from response</span>
<span class="kw"><a href="../reference/dbSaveData.html">dbSaveData</a></span>(data, con)  <span class="co"># from list</span>
<span class="kw"><a href="../reference/dbDisconnect.html">dbDisconnect</a></span>(con)</code></pre></div>
<p>It accepts two classes of inputs: <code>response</code> or <code>list</code>. <code>response</code> is the request response got by <code><a href="../reference/apiPollSession.html">apiPollSession()</a></code>. <code>list</code> is the data got by <code><a href="../reference/flightGet.html">flightGet()</a></code>.</p>
</div>
</div>
</div>
<div id="automatic-data-download" class="section level2">
<h2 class="hasAnchor">
<a href="#automatic-data-download" class="anchor"></a>Automatic Data Download</h2>
<div id="important-notice" class="section level3">
<h3 class="hasAnchor">
<a href="#important-notice" class="anchor"></a>Important Notice</h3>
<p>A feature that makes the <code>flightscanner</code> package unique, compared with the existing flight searching engines, is its functionality of automatic flight enquiry according to a schedule.</p>
<p>This part of functions only works on <strong>Unix/Linux/MacOS</strong>, not Windows. In the future, we will add Windows part.</p>
<p>If you use <strong>MacOS</strong> and meet the problem of “Operation not permitted”. Follow the instructions:</p>
<ol style="list-style-type: decimal">
<li>Pull down the Apple menu and choose “System Preferences”</li>
<li>Choose “Security &amp; Privacy” control panel</li>
<li>Now select the “Privacy” tab, then from the left-side menu select “Full Disk Access”</li>
<li>Click the lock icon in the lower left corner of the preference panel and authenticate with an admin level login</li>
<li>Now click the [+] plus button to add an application with full disk access</li>
<li>Navigate to the /Applications/ folder and choose “RStudio.app” or “R” to grant it with Full Disk Access privileges</li>
<li>Relaunch RStudio or R, the “Operation not permitted” error messages will be gone</li>
</ol>
</div>
<div id="create-and-manage-jobs" class="section level3">
<h3 class="hasAnchor">
<a href="#create-and-manage-jobs" class="anchor"></a>Create and Manage Jobs</h3>
<p>Creating Cron jobs is realized with the <code><a href="../reference/cron_create.html">cron_create()</a></code> function. Besides the regular flight information (such as orgin, destination, and dates), another input “frequency” is needed for the job schedule. It could be “minutely”, “hourly”, “daily” or other frequencies defined by Cron’s syntax, see <a href="https://en.wikipedia.org/wiki/Cron">link</a>. Here is an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/cron_create.html">cron_create</a></span>(<span class="st">"DSM"</span>, <span class="st">"SEA"</span>, <span class="st">"2019-07-20"</span>, <span class="dt">frequency =</span> <span class="st">"hourly"</span>)  <span class="co"># this is the example</span>
<span class="kw"><a href="../reference/cron_create.html">cron_create</a></span>(<span class="st">"DSM"</span>, <span class="st">"PVG"</span>, <span class="st">"2019-06-01"</span>, <span class="dt">frequency =</span> <span class="st">"0 */2 * * *"</span>)  <span class="co"># every 2 hours</span></code></pre></div>
<p>This function will generate a log file and a database file. All of the scheduled searching results are contained in this database file, e.g. “flight.db”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># connect to SQLite database</span>
con &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dbCreateDB.html">dbCreateDB</a></span>(<span class="dt">dbname =</span> <span class="st">"flight.db"</span>)
<span class="co"># read data from database</span>
data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flightGet.html">flightGet</a></span>(con)  
<span class="co"># show the searching time</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(data<span class="op">$</span>price<span class="op">$</span>SearchTime)
<span class="co">#&gt; [1] "2019-05-05 09:00:13 CDT" "2019-05-05 10:00:05 CDT"</span>
<span class="co">#&gt; [3] "2019-05-05 13:00:12 CDT" "2019-05-05 14:00:07 CDT"</span>
<span class="co">#&gt; [5] "2019-05-05 15:00:04 CDT" "2019-05-05 16:00:05 CDT"</span>
<span class="co"># disconnect database</span>
<span class="kw"><a href="../reference/dbDisconnect.html">dbDisconnect</a></span>(con)</code></pre></div>
<p>To show the current searching jobs, run the function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/cron_ls.html">cron_ls</a></span>()</code></pre></div>
<p>The job will be automatically excuted even if <code>R</code> is closed or the computer is restarted. To stop the job, run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/cron_clear.html">cron_clear</a></span>(<span class="dt">ask =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
</div>
<div id="shiny-app" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny-app" class="anchor"></a>Shiny App</h2>
<p>To open the Shiny App, run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">shiny<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/runApp">runApp</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="dt">package =</span> <span class="st">"flightscanner"</span>, <span class="st">"shiny"</span>))</code></pre></div>
<p>The Shiny App for the <code>flightscanner</code> includes three tabs: <strong>Airport Map</strong>, <strong>Flights</strong> and <strong>IATA Code</strong>.</p>
<div id="airport-map" class="section level3">
<h3 class="hasAnchor">
<a href="#airport-map" class="anchor"></a>Airport Map</h3>
<p>It is used as the welcome page by default. The map from <code>leaflet</code> shows the accurate locations of the target airports. It could provide a rough intuition about how far the users need to travel. Input values are needed on the top of the map when doing a flight search:</p>
<ul>
<li>
<strong>Trip type</strong>: one-way tirp or round trip.</li>
<li>
<strong>From</strong>, <strong>To</strong>: 3-character code for the departure/destination airport.</li>
<li>
<strong>Dept.Date</strong>, <strong>Arr.Date</strong>: departure date (no earlier than the current date) and return date (no earlier than the departure date). <strong>Arr.Date</strong> box would appear only when the <strong>round trip</strong> is selected.</li>
</ul>
<p>Click on the <strong>Go!</strong> button after providing the trip information.</p>
<p><img src="shinyMap.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="flights" class="section level3">
<h3 class="hasAnchor">
<a href="#flights" class="anchor"></a>Flights</h3>
<p>Click on the Flight tab after the search is complete. There are several filter options on the left panel.</p>
<ul>
<li>
<strong>Price</strong>: a slider ranging from the minimum to the maximum of the ticket prices.</li>
<li>
<strong>Airlines Includes</strong>, <strong>Airlines Excludes</strong>: the users can include or exclude some specific airlines.</li>
<li>
<strong>Duration</strong>: a slider ranging from the minimum to the maximum of the trip duration.</li>
<li>
<strong>Stops</strong>: the users can specify their preferences to the number of stransition stops.</li>
<li>
<strong>Layover</strong>: the total time to be spent at the transition stops.</li>
<li>
<strong>Outbound, Inbound</strong>: the users can choose a range of time for the departure time and arrival time, for both outbound flight and inbound flight using a 24-hour clock.</li>
</ul>
<p><img src="shinyTickets.png" width="100%" style="display: block; margin: auto;"></p>
<p>A table containing the detailed inforamtion about the filtered filghts will be given on the right main panel, including the ticket price, departure and arrival time for inbound and/or outbound flight, duration, and the number of stops for inbound and/or outbound. There are also hyperlinks to the ticketing agencies in the column of <strong>Link</strong>.</p>
</div>
<div id="iata-code" class="section level3">
<h3 class="hasAnchor">
<a href="#iata-code" class="anchor"></a>IATA Code</h3>
<p>Under this tab, users can search for the 3-character codes for the target airports by providing city or country names in the searching box in the upper right corner. The data comes from <code>MUCflight</code>.</p>
<p><img src="shinyCode.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#getting-started-with-flightscanner">Getting Started with flightscanner</a></li>
      <li><a href="#main-functions">Main Functions</a></li>
      <li><a href="#automatic-data-download">Automatic Data Download</a></li>
      <li><a href="#shiny-app">Shiny App</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Min Zhang, Dapeng Hu, Yang Qiao, Xin Zhang, Zerui Zhang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
